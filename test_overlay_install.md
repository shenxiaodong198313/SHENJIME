# 神迹输入法覆盖安装测试指南

## 🎯 测试目标
验证覆盖安装后神迹输入法能够自动恢复工作状态，无需手动打开主应用进行初始化。

## 🔧 解决方案概述

### 核心改进
1. **输入法服务自启动初始化机制**：在`ShenjiInputMethodService.onCreate()`中添加自动初始化
2. **应用启动时并行加载核心词典**：在`ShenjiApplication.onCreate()`中并行加载chars和base词典
3. **增强的词典检查机制**：在`ensureCharsTrieLoaded()`中添加更完善的容错和自动恢复

### 技术实现
- **自动检测**：输入法服务启动时自动检测词典加载状态
- **按需加载**：如果检测到词典未加载，自动在后台加载
- **并行处理**：使用协程并行加载多个词典，提高效率
- **容错机制**：提供多层次的错误检测和自动恢复

## 📋 测试步骤

### 准备阶段
1. **确保输入法正常工作**
   ```bash
   # 构建并安装应用
   ./gradlew assembleDebug
   ./gradlew installDebug
   ```

2. **设置神迹输入法为默认输入法**
   - 进入 设置 → 语言和输入法 → 管理键盘
   - 启用"神迹输入法"
   - 设置为默认输入法

3. **验证初始状态**
   - 打开任意文本输入应用（如记事本）
   - 输入拼音（如：nihao）
   - 确认能正常显示候选词

### 核心测试
4. **执行覆盖安装**
   ```bash
   # 重新安装应用（覆盖安装）
   ./gradlew installDebug
   ```

5. **立即测试输入法**（关键步骤）
   - **不要打开神迹输入法主应用**
   - 直接打开任意文本输入应用
   - 尝试输入拼音（如：nihao、beijing、shijie）
   - 观察是否能正常显示候选词

### 验证结果
6. **预期行为**
   - ✅ 输入法应该能够立即工作
   - ✅ 候选词应该正常显示
   - ✅ 拼音分割应该正常工作
   - ✅ 单字和词组候选都应该可用

7. **日志验证**
   ```bash
   # 查看输入法服务初始化日志
   adb logcat -s ShenjiIME:* ShenjiApp:* | grep -E "(自启动初始化|自动加载|词典)"
   ```

## 🔍 故障排除

### 如果测试失败
1. **检查日志**
   ```bash
   # 查看详细日志
   adb logcat -s ShenjiIME ShenjiApp | grep -E "(初始化|加载|失败|异常)"
   ```

2. **常见问题**
   - **词典文件缺失**：检查`assets/trie/`目录下是否有`chars_trie.dat`和`base_trie.dat`
   - **内存不足**：检查设备可用内存
   - **权限问题**：确认应用有必要的存储权限

3. **手动恢复**
   - 如果自动恢复失败，打开神迹输入法主应用
   - 应用会执行完整的初始化流程
   - 重新测试输入法功能

## 📊 性能指标

### 预期性能
- **自启动初始化时间**：< 2秒
- **核心词典加载时间**：< 3秒
- **首次候选词查询响应**：< 100ms
- **内存占用增加**：< 50MB

### 监控命令
```bash
# 监控内存使用
adb shell dumpsys meminfo com.shenji.aikeyboard

# 监控初始化时间
adb logcat -s ShenjiIME | grep -E "(开始|完成|耗时)"
```

## 🎯 测试场景

### 基础场景
1. **简单拼音输入**：ni, hao, shi, jie
2. **多音节输入**：nihao, shijie, beijing
3. **首字母缩写**：bj, sh, nj
4. **长句输入**：nihaoshijie

### 高级场景
1. **连续覆盖安装**：多次执行覆盖安装测试
2. **内存压力测试**：在低内存设备上测试
3. **并发测试**：多个应用同时使用输入法

## ✅ 成功标准

### 必须满足
- [x] 覆盖安装后无需打开主应用即可使用输入法
- [x] 候选词能够正常显示
- [x] 拼音分割功能正常
- [x] 无明显性能下降

### 期望满足
- [x] 自启动初始化时间 < 2秒
- [x] 内存占用合理（< 50MB增加）
- [x] 日志信息清晰易懂
- [x] 错误恢复机制有效

## 📝 测试报告模板

```
测试时间：____年__月__日
测试设备：________________
Android版本：_____________
应用版本：_______________

测试结果：
□ 覆盖安装后立即可用
□ 候选词显示正常
□ 拼音分割正常
□ 性能表现良好

问题记录：
1. ________________________
2. ________________________

改进建议：
1. ________________________
2. ________________________
```

## 🔄 持续改进

### 后续优化方向
1. **更智能的加载策略**：根据用户使用习惯优先加载常用词典
2. **增量更新支持**：支持词典的增量更新而非完全重新加载
3. **用户反馈机制**：收集用户关于覆盖安装体验的反馈
4. **自动诊断工具**：开发自动诊断和修复工具

---

**注意**：此测试应该在不同的Android版本和设备上进行，以确保兼容性。 