# 神迹输入法 (Shenji Input Method)

一款面向中文用户的智能Android输入法，支持Android 9至15设备，基于多层级词典系统提供高效输入体验。

## 核心功能

- **智能联想**：基于多种词典组合提供词语联想
- **标准键盘**：QWERTY键盘布局输入方式
- **词典管理**：包含9种专业词典，总计约260万词条
- **日志系统**：自动捕获崩溃信息并支持查看管理
- **输入测试**：提供专门的测试界面验证输入法功能和候选词列表

## 词典系统

| 词典类型 | 词条数量 | 说明 |
|---------|---------|------|
| chars | 10万 | 单字字典 |
| base | 78万 | 2-3字基础词组 |
| correlation | 57万 | 4字词组 |
| associational | 34万 | 5字以上词组 |
| compatible | 5千 | 多音字词组 |
| corrections | 137 | 错音错字词组 |
| place | 4.5万 | 地理位置词典 |
| people | 4万 | 人名词典 |
| poetry | 32万 | 诗词词典 |

### 管理功能

- 词典统计展示（词条总数、内存占用、模块数量）
- 词典模块浏览（支持分页加载，每页500条）
- 详细词条信息（词语、拼音、词频）

## 技术实现

### 架构设计
- **MVVM架构**：使用ViewModel与Repository模式
- **单例模式**：词典管理器采用单例设计
- **观察者模式**：使用LiveData和协程Flow监控状态

### 关键技术
- **后台加载**：不阻塞UI线程，保证应用流畅度
- **Realm数据库**：高效存储和查询大量词典数据

### 性能优化
- 分页加载避免一次性载入过多数据
- 使用DiffUtil优化列表更新性能
- 只加载必要的高频词典到内存

## 技术栈

- 开发语言：Kotlin
- 数据库：Realm-Kotlin
- 日志框架：Timber
- UI组件：RecyclerView、ViewBinding、Shimmer效果

## 使用方法

1. 安装应用
2. 在Android设置 → 语言和输入法 → 管理键盘中启用"神迹输入法"
3. 切换到"神迹输入法"作为默认输入法
4. 在主界面点击"输入测试"按钮可测试输入法功能

## 输入测试功能

测试界面包含以下功能：
- Realm词典连接状态检测
- 输入法日志实时显示（可复制和清除）
- 拼音输入测试区域
- 候选词列表展示

测试界面会捕获所有与输入法相关的日志，帮助排查问题。

## 日志系统

应用会自动捕获崩溃并记录到外部存储：
- 日志路径：`Android/data/com.shenji.aikeyboard/files/logs/crash_log.txt`
- 可通过应用主界面的"查看日志"按钮访问并管理日志

## 开发环境

- Android Studio Arctic Fox+
- JDK 17
- Gradle 8.7+
- Android SDK 34+

## 构建命令

```bash
# 构建Debug版本
./gradlew assembleDebug

# 安装到设备
./gradlew installDebug
```

## 技术文档详情

### 系统环境与依赖

- **开发语言**: Kotlin 2.0.20
- **目标平台**: Android 9.0+ (API 28 及以上)
- **构建工具**: Gradle 8.7
- **JVM 版本**: Java 17

#### 第三方库版本

| 依赖库 | 版本 | 用途 |
|--------|------|------|
| Realm数据库 | 2.3.0 | 词典存储与查询 |
| AndroidX Core KTX | 1.12.0 | Android核心功能扩展 |
| AndroidX AppCompat | 1.7.0 | 向下兼容支持 |
| Material Components | 1.11.0 | UI组件 |
| ConstraintLayout | 2.1.4 | 布局管理 |
| AndroidX Lifecycle | 2.7.0 | 生命周期管理 |
| Facebook Shimmer | 0.5.0 | 加载效果 |
| SnakeYAML | 2.2 | YAML配置解析 |
| Kotlin Coroutines | 1.8.0 | 异步编程 |
| Timber | 5.0.1 | 日志管理 |
| Android Gradle Plugin | 8.6.0 | Android构建支持 |





# 以下是对当前项目的整体总结，内容涵盖词典数据库、分词器、候选词等核心模块。

---

# 项目技术文档

## 1. 词典数据库

### 1.1 数据库类型

- **类型**：Realm（移动端高性能本地数据库）
- **文件位置**：`assets/shenji_dict.realm`
- **主要表结构**：`Entry`（词条表）

### 1.2 表结构与字段说明

#### Entry（词条表）

| 字段名         | 类型     | 说明                                                         | 示例           | 备注           |
| -------------- | -------- | ------------------------------------------------------------ | -------------- | -------------- |
| id             | String   | 主键，唯一标识词条                                           | "123456"       | @PrimaryKey    |
| word           | String   | 词条文本内容，存储汉字词语或单字                             | "北京"         |                |
| pinyin         | String   | 词条拼音，完整拼音，空格分隔每个字的拼音                     | "bei jing"     | @Index         |
| initialLetters | String   | 拼音首字母缩写，用于首字母输入匹配，如"北京"为"bj"           | "bj"           | @Index         |
| frequency      | Int      | 词频，数值越高表示越常用，用于候选词排序                     | 12345          |                |
| type           | String   | 词典类型（如chars、base、correlation等，见下表）             | "base"         |                |

#### type 字段取值说明

| 类型           | 中文说明   | 典型用途         |
| -------------- | ---------- | ---------------- |
| chars          | 单字词典   | 单字输入         |
| base           | 基础词典   | 常用词组         |
| correlation    | 关联词典   | 相关词推荐       |
| associational  | 联想词典   | 联想输入         |
| compatible     | 兼容词典   | 兼容老词库       |
| corrections    | 纠错词典   | 拼写纠错         |
| place          | 地名词典   | 地名输入         |
| people         | 人名词典   | 人名输入         |
| poetry         | 诗词词典   | 诗词输入         |

#### 字段格式示例

```json
{
  "id": "abc123",
  "word": "北京",
  "pinyin": "bei jing",
  "initialLetters": "bj",
  "frequency": 10000,
  "type": "base"
}
```

### 1.3 索引说明

- `id`：主键索引，唯一标识每条数据。
- `pinyin`：拼音字段建立索引，加速拼音查询。
- `initialLetters`：拼音首字母缩写字段建立索引，加速首字母缩写查询。

### 1.4 典型表内容示例

| word | pinyin    | initialLetters | frequency | type   |
|------|-----------|---------------|-----------|--------|
| 北京 | bei jing  | bj            | 10000     | base   |
| 你好 | ni hao    | nh            | 9000      | base   |
| 张三 | zhang san | zs            | 8000      | people |
| 上海 | shang hai | sh            | 9500      | place  |

---

## 2. 分词器

### 2.1 音节校验说明

- **音节表**：内置完整汉语拼音音节表，支持所有标准音节及部分变体（如v/ü）。
- **校验方式**：输入拼音时，分词器会校验每一段是否为合法音节，支持动态规划、贪心、混合等多种分词方式。

### 2.2 分词逻辑说明

- **标准分词**：优先尝试将输入完整拆分为标准音节序列（如"nihao"→["ni", "hao"]）。
- **混合模式**：支持“首字母+音节”混合输入（如"sji"→["s", "ji"]）。
- **多策略兜底**：如标准分词失败，尝试最长匹配、部分匹配等兜底策略，确保尽量拆分出有效音节。
- **优化分词**：引入`PinyinSegmenterOptimized`，解决常见分词歧义（如"nihao"不会被拆成"n+i+hao"）。

---

## 3. 候选词

### 3.1 排序说明

- **主排序字段**：`frequency`（词频，降序）
- **补充排序**：如有多种来源结果，先按主策略结果，再补充其他策略结果，去重后按词频降序。

### 3.2 查询说明

- **拼音查询**：支持完整拼音、拼音前缀、首字母缩写等多种方式。
- **类型过滤**：可按type字段过滤（如只查基础词典、排除诗词等）。
- **多音节组合**：支持多音节组合查询，优先查标准拼音，结果不足时查无空格拼音、再查其他词典。

### 3.3 候选词生成说明

- **策略模式**：候选词生成采用多策略模式，按优先级依次尝试：
  1. 单字母输入（如"b"→所有b开头的单字）
  2. 精确音节匹配（如"ni"→"你"、"泥"等）
  3. 拼音补全（如"beij"→"北京"、"背景"等）
  4. 首字母缩写（如"bj"→"北京"、"保健"等）
  5. 音节拆分兜底（如"shbj"→"上海北京"等组合）
- **去重与补全**：主策略结果不足时自动补全，所有结果去重后统一排序。

---

## 4. 其他说明

- **词典文件**：支持多词典（如地名、人名、诗词等），可灵活扩展。
- **性能优化**：所有高频查询字段均加索引，分词和候选词生成均有兜底策略，保证响应速度和准确率。
- **可扩展性**：词典类型、分词策略、候选词生成策略均可按需扩展。

---










