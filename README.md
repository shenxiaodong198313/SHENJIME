# ç¥è¿¹è¾“å…¥æ³• (Shenji Input Method)

<div align="center">

![Android](https://img.shields.io/badge/Android-9%2B-green.svg)
![Kotlin](https://img.shields.io/badge/Kotlin-2.0.21-blue.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
![Version](https://img.shields.io/badge/Version-1.0-red.svg)
![AI](https://img.shields.io/badge/AI-Gemma%203--1B--IT-purple.svg)
![Build](https://img.shields.io/badge/Build-Gradle%208.7-orange.svg)

**ğŸš€ ä¼ä¸šçº§æ™ºèƒ½ä¸­æ–‡è¾“å…¥æ³• | æœ¬åœ°AIæ¨ç† | æ¯«ç§’çº§å“åº” | 260ä¸‡è¯æ¡**

ä¸€æ¬¾é¢å‘ä¸­æ–‡ç”¨æˆ·çš„**é«˜æ€§èƒ½æ™ºèƒ½è¾“å…¥æ³•**ï¼Œé›†æˆæœ¬åœ°LLMæ¨ç†èƒ½åŠ›ï¼ŒåŸºäºå¤šå±‚çº§è¯å…¸ç³»ç»Ÿå’Œä¼˜åŒ–çš„Trieæ ‘ç»“æ„ï¼Œæä¾›æµç•…çš„ä¸­æ–‡è¾“å…¥ä½“éªŒå’Œæ™ºèƒ½æ–‡æœ¬ç”ŸæˆåŠŸèƒ½ã€‚

**ğŸ” å€™é€‰è¯å¼•æ“ç‰¹è‰²**ï¼šé‡‡ç”¨ä¸‰å±‚æ™ºèƒ½æŸ¥è¯¢æ¶æ„ï¼Œæ”¯æŒ6ç§æŸ¥è¯¢ç­–ç•¥å’Œ6ç§åŒ¹é…æ–¹æ³•ï¼Œå®ç°äº†æ¸è¿›å¼ç¼“å­˜ã€æ™ºèƒ½åˆ†å±‚ç»„åˆã€å¤šTrieæ ‘å¹¶è¡ŒæŸ¥è¯¢ç­‰ä¼ä¸šçº§ç‰¹æ€§ï¼ŒæŸ¥è¯¢å“åº”æ—¶é—´1-3msï¼Œç¼“å­˜å‘½ä¸­ç‡>90%ã€‚

**ğŸ¤– AIæ™ºèƒ½ç‰¹è‰²**ï¼šé›†æˆGoogle Gemma 3-1B-ITæ¨¡å‹ï¼Œæ”¯æŒæœ¬åœ°LLMæ¨ç†ï¼Œæä¾›æ™ºèƒ½æ–‡æœ¬ç”Ÿæˆã€æ‹¼éŸ³çº é”™å’Œè¯­ä¹‰åˆ†æåŠŸèƒ½ï¼Œå®Œå…¨ç¦»çº¿è¿è¡Œï¼Œä¿æŠ¤ç”¨æˆ·éšç§ã€‚

[åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [AIèƒ½åŠ›](#-aièƒ½åŠ›) â€¢ [æŠ€æœ¯æ¶æ„](#-æŠ€æœ¯æ¶æ„) â€¢ [å¼•æ“è¯¦è§£](#-å¼•æ“è¯¦è§£) â€¢ [æ€§èƒ½æŒ‡æ ‡](#-æ€§èƒ½æŒ‡æ ‡) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)

</div>

## ğŸ“± é¡¹ç›®æ¦‚è¿°

ç¥è¿¹è¾“å…¥æ³•æ˜¯ä¸€æ¬¾ä¸“ä¸ºAndroidå¹³å°è®¾è®¡çš„**ä¼ä¸šçº§æ™ºèƒ½ä¸­æ–‡è¾“å…¥æ³•**ï¼Œæ”¯æŒAndroid 9è‡³15è®¾å¤‡ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼Œé€šè¿‡å¤šå±‚çº§è¯å…¸ç³»ç»Ÿã€ä¼˜åŒ–çš„æ•°æ®ç»“æ„å’Œæœ¬åœ°AIæ¨ç†èƒ½åŠ›ï¼Œä¸ºç”¨æˆ·æä¾›é«˜æ•ˆã€å‡†ç¡®ã€æ™ºèƒ½çš„ä¸­æ–‡è¾“å…¥ä½“éªŒã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹è‰²

- **ğŸš€ æ¯«ç§’çº§å“åº”**ï¼šåŸºäºTrieæ ‘çš„å†…å­˜è¯å…¸ï¼ŒæŸ¥è¯¢å“åº”æ—¶é—´1-3ms
- **ğŸ¤– æœ¬åœ°AIæ¨ç†**ï¼šé›†æˆGemma 3-1B-ITæ¨¡å‹ï¼Œå®Œå…¨ç¦»çº¿è¿è¡Œ
- **ğŸ§  æ™ºèƒ½ä¸‰å±‚å¼•æ“**ï¼šSmartPinyinEngine + IntelligentQueryEngine + ContinuousPinyinEngine
- **ğŸ“š æµ·é‡è¯åº“**ï¼š260ä¸‡è¯æ¡ï¼Œæ¶µç›–åŸºç¡€è¯æ±‡ã€åœ°åã€äººåã€è¯—è¯ç­‰
- **âš¡ å¿«é€Ÿå¯åŠ¨**ï¼šåˆ†å±‚åŠ è½½ç­–ç•¥ï¼Œå†·å¯åŠ¨æ—¶é—´<500ms
- **ğŸ”§ ä¼ä¸šçº§æ¶æ„**ï¼šå®Œæ•´çš„è°ƒè¯•å·¥å…·å’Œæ€§èƒ½ç›‘æ§
- **ğŸ¯ æ™ºèƒ½åˆ†å±‚**ï¼šæŒ‰éŸ³èŠ‚æ•°æ™ºèƒ½åˆ†å±‚æ˜¾ç¤ºå€™é€‰è¯ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- **ğŸ”„ æ¸è¿›å¼æŸ¥è¯¢**ï¼šæ”¯æŒåˆ†é¡µåŠ è½½å’Œç¼“å­˜ä¼˜åŒ–ï¼Œé¿å…æ€§èƒ½ç“¶é¢ˆ
- **ğŸ§© å¤šç­–ç•¥å¼•æ“**ï¼š6ç§æŸ¥è¯¢ç­–ç•¥ + 6ç§åŒ¹é…æ–¹æ³•ï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ
- **ğŸ›¡ï¸ éšç§ä¿æŠ¤**ï¼šæœ¬åœ°AIæ¨ç†ï¼Œæ•°æ®ä¸ä¸Šä¼ ï¼Œå®Œå…¨ä¿æŠ¤ç”¨æˆ·éšç§

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¹ è¾“å…¥åŠŸèƒ½
- **æ ‡å‡†QWERTYé”®ç›˜**ï¼šæ”¯æŒå…¨æ‹¼è¾“å…¥
- **æ™ºèƒ½å€™é€‰è¯**ï¼šåŸºäºè¯é¢‘å’Œä¸Šä¸‹æ–‡çš„æ™ºèƒ½æ’åº
- **é¦–å­—æ¯ç¼©å†™**ï¼šæ”¯æŒå¿«é€Ÿé¦–å­—æ¯è¾“å…¥ï¼ˆå¦‚ï¼šbj â†’ åŒ—äº¬ï¼‰
- **éŸ³èŠ‚æ‹†åˆ†**ï¼šæ™ºèƒ½æ‹¼éŸ³åˆ†è¯å’Œç»„åˆ
- **æ¨¡ç³Šæ‹¼éŸ³**ï¼šæ”¯æŒzh/zã€ch/cã€sh/sç­‰æ¨¡ç³ŠéŸ³
- **åˆ†å±‚å€™é€‰è¯**ï¼šæ™ºèƒ½åˆ†å±‚æ˜¾ç¤ºï¼Œä¼˜å…ˆæ˜¾ç¤ºä¸éŸ³èŠ‚æ•°åŒ¹é…çš„è¯ç»„
- **æ¸è¿›å¼æŸ¥è¯¢**ï¼šæ”¯æŒåˆ†é¡µåŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šå€™é€‰è¯
- **å®æ—¶åˆ†å‰²**ï¼šåŠ¨æ€æ‹¼éŸ³åˆ†å‰²ï¼Œæ”¯æŒè¾“å…¥è¿‡ç¨‹ä¸­çš„å®æ—¶å€™é€‰è¯æ›´æ–°
- **è¿ç»­æ‹¼éŸ³**ï¼šæ™ºèƒ½è¯†åˆ«å’Œå¤„ç†è¿ç»­æ‹¼éŸ³è¾“å…¥
- **é˜²é—ªçƒä¼˜åŒ–**ï¼šæ™ºèƒ½é˜²æŠ– + åŒç¼“å†²æŠ€æœ¯ï¼Œ95%+é—ªçƒæ¶ˆé™¤

## ğŸ¤– AIèƒ½åŠ›

### ğŸ§  åŒå¼•æ“AIæ¨ç†æ¶æ„
- **MediaPipeå¼•æ“**ï¼šGoogle Gemma 3-1B-IT (INT4é‡åŒ–)ï¼Œ529MBæ¨¡å‹
- **MNNç§»åŠ¨æ¨ç†æ¡†æ¶**ï¼šé˜¿é‡Œå·´å·´MNNé«˜æ€§èƒ½æ¨ç†å¼•æ“ï¼Œæ”¯æŒå¤šæ¨¡æ€
- **æ¨ç†æ€§èƒ½**ï¼šSamsung S24 Ultraä¸Šå¯è¾¾47 tokens/sec
- **å†…å­˜å ç”¨**ï¼šçº¦3GBè¿è¡Œå†…å­˜
- **å“åº”æ—¶é—´**ï¼šé¦–æ¬¡å“åº”çº¦3ç§’
- **æ¶æ„ä¼˜åŠ¿**ï¼šåŒå¼•æ“æ”¯æŒï¼Œå¯æ ¹æ®åœºæ™¯é€‰æ‹©æœ€ä¼˜æ¨ç†æ–¹æ¡ˆ

### ğŸ¯ AIåŠŸèƒ½ç‰¹æ€§
- **æ™ºèƒ½æ‹¼éŸ³çº é”™**ï¼šåŸºäºä¸Šä¸‹æ–‡çš„æ‹¼éŸ³é”™è¯¯æ£€æµ‹å’Œçº æ­£
- **æ–‡æœ¬ç»­å†™**ï¼šæ™ºèƒ½æ–‡æœ¬è¡¥å…¨å’Œç”Ÿæˆå»ºè®®
- **è¯­ä¹‰åˆ†æ**ï¼šç†è§£ç”¨æˆ·è¾“å…¥æ„å›¾ï¼Œæä¾›ç›¸å…³å»ºè®®
- **å®Œå…¨ç¦»çº¿**ï¼šæ‰€æœ‰AIæ¨ç†åœ¨æœ¬åœ°è¿›è¡Œï¼Œä¿æŠ¤ç”¨æˆ·éšç§
- **å®æ—¶å“åº”**ï¼šä¼˜åŒ–çš„æ¨ç†å¼•æ“ï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒ
- **å¤šåœºæ™¯é€‚é…**ï¼šæ”¯æŒä¸åŒè¾“å…¥åœºæ™¯çš„æ™ºèƒ½é€‚é…

### ğŸ“– è¯å…¸ç³»ç»Ÿ
| è¯å…¸ç±»å‹ | è¯æ¡æ•°é‡ | æ–‡ä»¶å¤§å° | è¯´æ˜ |
|---------|---------|----------|------|
| chars | 10ä¸‡ | 570KB | å•å­—å­—å…¸ |
| base | 78ä¸‡ | 11MB | 2-3å­—åŸºç¡€è¯ç»„ |
| correlation | 57ä¸‡ | 7.0MB | 4å­—è¯ç»„ |
| associational | 34ä¸‡ | 4.8MB | 5å­—ä»¥ä¸Šè¯ç»„ |
| place | 4.5ä¸‡ | 493KB | åœ°ç†ä½ç½®è¯å…¸ |
| people | 4ä¸‡ | 402KB | äººåè¯å…¸ |
| poetry | 32ä¸‡ | 4.6MB | è¯—è¯è¯å…¸ |
| corrections | 137 | 1.4KB | é”™éŸ³é”™å­—çº æ­£ |
| compatible | 5åƒ | 49KB | å¤šéŸ³å­—å…¼å®¹ |

### ğŸ› ï¸ å¼€å‘å·¥å…·
- **Trieæ„å»ºå™¨**ï¼šå¯è§†åŒ–è¯å…¸æ„å»ºå’Œç®¡ç†
- **è¾“å…¥è°ƒè¯•å™¨**ï¼šå®æ—¶å€™é€‰è¯åˆ†æå’Œæ€§èƒ½ç›‘æ§
- **è¯å…¸ç®¡ç†å™¨**ï¼šè¯å…¸ç»Ÿè®¡ã€æµè§ˆå’Œç»´æŠ¤
- **ç³»ç»Ÿæ£€æŸ¥å™¨**ï¼šå†…å­˜ä½¿ç”¨å’Œæ€§èƒ½åˆ†æ
- **æ—¥å¿—ç³»ç»Ÿ**ï¼šå®Œæ•´çš„é”™è¯¯è¿½è¸ªå’Œè°ƒè¯•ä¿¡æ¯
- **æŸ¥è¯¢åˆ†æå™¨**ï¼šå®æ—¶æŸ¥è¯¢ç­–ç•¥åˆ†æå’Œæ€§èƒ½ç»Ÿè®¡
- **ç¼“å­˜ç›‘æ§**ï¼šLRUç¼“å­˜å‘½ä¸­ç‡å’Œå†…å­˜ä½¿ç”¨ç›‘æ§
- **AIè°ƒè¯•å™¨**ï¼šLLMæ¨ç†æ€§èƒ½ç›‘æ§å’Œè°ƒè¯•å·¥å…·

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ğŸ“‹ æŠ€æœ¯æ ˆ
- **å¼€å‘è¯­è¨€**ï¼šKotlin 2.0.21 + C++17
- **æœ€ä½ç‰ˆæœ¬**ï¼šAndroid 9.0 (API 26)
- **ç›®æ ‡ç‰ˆæœ¬**ï¼šAndroid 15 (API 35)
- **æ„å»ºå·¥å…·**ï¼šGradle 8.7 + JDK 21 + CMake 3.22.1
- **æ•°æ®åº“**ï¼šRealm-Kotlin 2.3.0
- **UIæ¡†æ¶**ï¼šViewBinding + Material Design
- **å¼‚æ­¥å¤„ç†**ï¼šKotlin Coroutines 1.8.0
- **æ—¥å¿—æ¡†æ¶**ï¼šTimber 5.0.1
- **AIæ¡†æ¶**ï¼šMediaPipe LLM Inference API 0.10.24 + é˜¿é‡Œå·´å·´MNN
- **LLMæ¨¡å‹**ï¼šGemma 3-1B-IT (INT4é‡åŒ–)
- **Nativeåº“**ï¼šMNNæ¨ç†å¼•æ“ (5.7MB)

### ğŸ›ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MainActivity  â”‚  InputMethodService  â”‚  DebugActivities   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Business Layer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SmartPinyinEngine â”‚ IntelligentQueryEngine â”‚ InputStrategy â”‚
â”‚ LlmManager        â”‚ ContinuousPinyinEngine â”‚ FuzzyPinyin   â”‚
â”‚ AIEngineManager   â”‚ InputMethodAIAdapter   â”‚ Gemma3Engine  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Data Layer                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TrieManager  â”‚ UnifiedPinyinSplitter â”‚ DictionaryRepositoryâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Storage Layer                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Realm Database   â”‚    Trie Files    â”‚   LLM Models      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” å¼•æ“è¯¦è§£

### ğŸ§  ä¸‰å±‚å€™é€‰è¯å¼•æ“æ¶æ„

ç¥è¿¹è¾“å…¥æ³•é‡‡ç”¨ä¸‰å±‚å€™é€‰è¯å¼•æ“æ¶æ„ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€æ™ºèƒ½åŒ–çš„ä¸­æ–‡è¾“å…¥ä½“éªŒï¼š

#### 1. SmartPinyinEngine (æ™ºèƒ½æ‹¼éŸ³å¼•æ“)
- **åŠŸèƒ½**ï¼šé¡¹ç›®ä¸­å®é™…ä½¿ç”¨çš„ä¸»è¦å€™é€‰è¯æŸ¥è¯¢å¼•æ“
- **ç‰¹æ€§**ï¼š
  - æ™ºèƒ½è¾“å…¥ç±»å‹æ£€æµ‹ï¼ˆå•å­—ç¬¦ã€ç¼©å†™ã€çŸ­è¾“å…¥ã€ä¸­ç­‰è¾“å…¥ã€é•¿è¾“å…¥ã€è¶…é™è¾“å…¥ï¼‰
  - åˆ†å±‚æŸ¥è¯¢ç­–ç•¥ï¼ˆå•å­—+åŸºç¡€è¯ç»„ä¼˜å…ˆã€ç¼©å†™åŒ¹é…ã€å…³è”è¯ç»„ä¼˜å…ˆç­‰ï¼‰
  - LRUç¼“å­˜ç³»ç»Ÿï¼ˆ100æ¡æŸ¥è¯¢ç¼“å­˜ï¼‰
  - æ€§èƒ½ç»Ÿè®¡å’Œç›‘æ§ï¼ˆæŸ¥è¯¢æ¬¡æ•°ã€ç¼“å­˜å‘½ä¸­ç‡ï¼‰
  - åç¨‹å¹¶å‘å¤„ç†
  - æ™ºèƒ½è¾“å…¥åˆ†ç¦»ï¼ˆä¸­æ–‡+æ‹¼éŸ³æ··åˆè¾“å…¥å¤„ç†ï¼‰

#### 2. IntelligentQueryEngine (æ™ºèƒ½æŸ¥è¯¢å¼•æ“)
- **åŠŸèƒ½**ï¼šæ‰§è¡Œå…·ä½“çš„æŸ¥è¯¢æ–¹æ³•
- **ç‰¹æ€§**ï¼š
  - 6ç§æŸ¥è¯¢æ–¹æ³•ï¼ˆç²¾ç¡®åŒ¹é…ã€å‰ç¼€åŒ¹é…ã€æ¨¡ç³ŠåŒ¹é…ã€ç¼©å†™åŒ¹é…ã€åˆ†æ®µåŒ¹é…ã€éŸ³èŠ‚åŒ¹é…ï¼‰
  - å¤šTrieæ ‘å¹¶è¡ŒæŸ¥è¯¢
  - æ™ºèƒ½ç»“æœåˆå¹¶å’Œå»é‡
  - æ¨¡ç³Šæ‹¼éŸ³å˜ä½“ç”Ÿæˆ

#### 3. ContinuousPinyinEngine (è¿ç»­æ‹¼éŸ³å¼•æ“)
- **åŠŸèƒ½**ï¼šå¤„ç†è¿ç»­æ‹¼éŸ³è¾“å…¥çš„ä¸“ç”¨å¼•æ“
- **ç‰¹æ€§**ï¼š
  - æ™ºèƒ½è¿ç»­æ‹¼éŸ³æ£€æµ‹
  - å¤šç§åˆ†è¯æ–¹æ¡ˆç”Ÿæˆ
  - é«˜é¢‘è¯ä¼˜å…ˆç»„åˆ
  - æ€§èƒ½ä¼˜åŒ–çš„åˆ†å±‚æŸ¥è¯¢

#### 4. åŒå¼•æ“AIé›†æˆæ¶æ„

##### AIEngineManager (AIå¼•æ“ç®¡ç†å™¨)
- **åŠŸèƒ½**ï¼šç®¡ç†å¤šä¸ªAIå¼•æ“çš„ç”Ÿå‘½å‘¨æœŸ
- **ç‰¹æ€§**ï¼š
  - åŒå¼•æ“æ”¯æŒå’Œæ™ºèƒ½åˆ‡æ¢
  - å¼‚æ­¥åˆå§‹åŒ–å’Œèµ„æºç®¡ç†
  - ç»Ÿä¸€çš„AIåŠŸèƒ½æ¥å£

##### MediaPipeå¼•æ“ (Gemma3Engine)
- **åŠŸèƒ½**ï¼šåŸºäºMediaPipeçš„Gemma3-1B-ITæ¨¡å‹å¼•æ“
- **ç‰¹æ€§**ï¼š
  - æœ¬åœ°LLMæ¨ç†
  - æ‹¼éŸ³çº é”™ã€æ–‡æœ¬ç»­å†™ã€è¯­ä¹‰åˆ†æ
  - å†…å­˜ä¼˜åŒ–å’Œæ€§èƒ½ç›‘æ§

##### MNNç§»åŠ¨æ¨ç†å¼•æ“ (MnnLlmSession)
- **åŠŸèƒ½**ï¼šåŸºäºé˜¿é‡Œå·´å·´MNNçš„é«˜æ€§èƒ½æ¨ç†å¼•æ“
- **ç‰¹æ€§**ï¼š
  - C++åŸç”Ÿæ¨ç†ï¼Œæ€§èƒ½æ›´ä¼˜
  - æ”¯æŒå¤šæ¨¡æ€AIæ¨¡å‹
  - å†…å­˜æ˜ å°„ä¼˜åŒ–
  - JNIæ¥å£é›†æˆ
  - éŸ³é¢‘æ•°æ®å¤„ç†æ”¯æŒ

##### InputMethodAIAdapter (è¾“å…¥æ³•AIé€‚é…å™¨)
- **åŠŸèƒ½**ï¼šè¿æ¥è¾“å…¥æ³•æœåŠ¡ä¸AIå¼•æ“
- **ç‰¹æ€§**ï¼š
  - åŒå¼•æ“æ™ºèƒ½è°ƒåº¦
  - AIåŠŸèƒ½è°ƒç”¨å’Œç»“æœå±•ç¤º
  - ä¸Šä¸‹æ–‡ä¿¡æ¯ç®¡ç†
  - æ™ºèƒ½æç¤ºæ˜¾ç¤º

### ğŸ”§ æ‹¼éŸ³åˆ†å‰²é€»è¾‘

#### UnifiedPinyinSplitter (ç»Ÿä¸€æ‹¼éŸ³åˆ†å‰²å™¨)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **ç»Ÿä¸€æ¥å£**ï¼šæä¾›ä¸€è‡´çš„æ‹¼éŸ³åˆ†å‰²API
- **5ç§åˆ†å‰²æ¨¡å¼**ï¼šå®Œæ•´ã€åŠ¨æ€ã€æ™ºèƒ½ã€åˆ†æ®µã€å¤šæ–¹æ¡ˆ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé›†æˆç¼“å­˜ç­–ç•¥å’Œæœ€ä¼˜ç®—æ³•

**åˆ†å‰²ç­–ç•¥**ï¼š
```kotlin
// ä¸»è¦åˆ†å‰²æ–¹æ³•
fun split(input: String): List<String>

// å¤šç§åˆ†å‰²æ–¹æ¡ˆ
fun getMultipleSplits(input: String): List<List<String>>

// åŠ¨æ€åˆ†å‰²ï¼ˆå®æ—¶è¾“å…¥ï¼‰
fun splitDynamic(input: String): List<String>

// æ™ºèƒ½åˆ†å‰²ï¼ˆæœ€ä½³ç»“æœï¼‰
fun splitSmart(input: String): List<String>

// åˆ†æ®µæ‹†åˆ†ï¼ˆé•¿å¥å¤„ç†ï¼‰
fun splitIntoSegments(input: String): List<List<String>>
```

**åˆ†å‰²ç®—æ³•**ï¼š
1. **åŸºç¡€éŸ³èŠ‚è¯†åˆ«**ï¼šåŸºäºé¢„å®šä¹‰éŸ³èŠ‚åº“è¿›è¡ŒåŒ¹é…
2. **è´ªå¿ƒç®—æ³•**ï¼šä¼˜å…ˆåŒ¹é…æœ€é•¿æœ‰æ•ˆéŸ³èŠ‚
3. **å›æº¯æœºåˆ¶**ï¼šå¤„ç†æ­§ä¹‰åˆ†å‰²æƒ…å†µ
4. **æ™ºèƒ½åˆ†æ®µ**ï¼šé•¿å¥æ™ºèƒ½åˆ†æ®µç»„åˆï¼ˆ2+4ã€4+2ã€3+3ç­‰ï¼‰

### ğŸ¯ åŒ¹é…é€»è¾‘

#### æŸ¥è¯¢ç­–ç•¥æšä¸¾
```kotlin
enum class QueryStrategy {
    CHARS_BASE_PRIORITY,    // å•å­—+åŸºç¡€è¯ç»„ä¼˜å…ˆ
    ABBREVIATION_MATCH,     // ç¼©å†™åŒ¹é…
    CORRELATION_PRIORITY,   // 4å­—è¯ç»„ä¼˜å…ˆ
    ASSOCIATIONAL_PRIORITY, // é•¿è¯ç»„ä¼˜å…ˆ
    STOP_QUERY             // åœæ­¢æŸ¥è¯¢
}
```

#### è¾“å…¥ç±»å‹è¯†åˆ«
```kotlin
enum class InputType {
    SINGLE_CHAR,        // å•å­—ç¬¦
    ABBREVIATION,       // ç¼©å†™
    SHORT_INPUT,        // çŸ­è¾“å…¥(2-3åˆ†æ®µ)
    MEDIUM_INPUT,       // ä¸­ç­‰è¾“å…¥(4åˆ†æ®µ)
    LONG_INPUT,         // é•¿è¾“å…¥(5-6åˆ†æ®µ)
    OVER_LIMIT          // è¶…è¿‡é™åˆ¶(7+åˆ†æ®µ)
}
```

#### åŒ¹é…æ–¹æ³•
```kotlin
enum class QueryMethod {
    EXACT_MATCH,        // ç²¾ç¡®åŒ¹é…
    PREFIX_MATCH,       // å‰ç¼€åŒ¹é…
    FUZZY_MATCH,        // æ¨¡ç³ŠåŒ¹é…
    ABBREVIATION_MATCH, // ç¼©å†™åŒ¹é…
    SEGMENTED_MATCH,    // åˆ†æ®µåŒ¹é…
    SYLLABLE_MATCH      // éŸ³èŠ‚åŒ¹é…
}
```

### ğŸ—ï¸ æŸ¥è¯¢é€»è¾‘

#### åˆ†å±‚æŸ¥è¯¢ç­–ç•¥
```kotlin
// æ™ºèƒ½åˆ†å±‚æ˜¾ç¤ºç­–ç•¥
ç¬¬1å±‚: å®Œæ•´çŸ­è¯­åŒ¹é…ï¼ˆä¸éŸ³èŠ‚æ•°ç›¸åŒçš„è¯ç»„ï¼‰
ç¬¬2å±‚: æ™ºèƒ½åˆ†æ®µç»„åˆï¼ˆ2+4ã€4+2ã€3+3ç­‰åˆ†æ®µï¼‰
ç¬¬3å±‚: å¸¸ç”¨çŸ­è¯­ä¼˜å…ˆï¼ˆ2-3å­—é«˜é¢‘è¯ç»„ï¼‰
ç¬¬4-Nå±‚: æŒ‰éŸ³èŠ‚é¡ºåºçš„å•å­—å€™é€‰

// ç¤ºä¾‹ï¼šjin tian tian qi hen hao (6ä¸ªéŸ³èŠ‚)
ç¬¬1å±‚: 6å­—å®Œæ•´çŸ­è¯­
ç¬¬2å±‚: "ä»Šå¤©" + "å¤©æ°”å¾ˆå¥½" (2+4åˆ†æ®µ)
ç¬¬3å±‚: "ä»Šå¤©å¤©æ°”" + "å¾ˆå¥½" (4+2åˆ†æ®µ)
ç¬¬4å±‚: "ä»Šå¤©å¤©" + "æ°”å¾ˆå¥½" (3+3åˆ†æ®µ)
```

#### æŸ¥è¯¢æµç¨‹
1. **è¾“å…¥åˆ†æ**ï¼šè¯†åˆ«è¾“å…¥ç±»å‹å’Œåˆ†å‰²æ–¹æ¡ˆ
2. **ç­–ç•¥é€‰æ‹©**ï¼šæ ¹æ®è¾“å…¥ç±»å‹é€‰æ‹©æœ€ä¼˜æŸ¥è¯¢ç­–ç•¥
3. **å¹¶è¡ŒæŸ¥è¯¢**ï¼šå¤šTrieæ ‘å¹¶è¡Œæœç´¢
4. **ç»“æœåˆå¹¶**ï¼šå»é‡ã€æ’åºã€åˆ†å±‚æ˜¾ç¤º
5. **ç¼“å­˜æ›´æ–°**ï¼šæ›´æ–°LRUç¼“å­˜
6. **AIå¢å¼º**ï¼šå¯é€‰çš„LLMæ™ºèƒ½è¡¥å…¨

#### å›é€€æœºåˆ¶
```kotlin
// TrieæŸ¥è¯¢å¤±è´¥æ—¶å›é€€åˆ°Realmæ•°æ®åº“
private suspend fun queryWithFallback(
    trieTypes: List<TrieType>,
    query: String,
    limit: Int
): List<WordFrequency> {
    // 1. ä¼˜å…ˆTrieæŸ¥è¯¢
    val trieResults = queryFromTrie(trieTypes, query, limit)
    
    // 2. ç»“æœä¸è¶³æ—¶å›é€€åˆ°Realm
    if (trieResults.size < limit) {
        val realmResults = queryFromRealm(query, limit)
        return (trieResults + realmResults).distinctBy { it.word }
    }
    
    return trieResults
}
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ğŸ“Š Realmæ•°æ®åº“ç»“æ„

#### Entryæ•°æ®æ¨¡å‹
```kotlin
open class Entry : RealmObject {
    @PrimaryKey
    var id: String = ""           // è¯æ¡å”¯ä¸€æ ‡è¯†ç¬¦
    
    var word: String = ""         // è¯æ¡æ–‡æœ¬å†…å®¹
    
    @Index
    var pinyin: String = ""       // è¯æ¡æ‹¼éŸ³ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
    
    @Index
    var initialLetters: String = "" // æ‹¼éŸ³é¦–å­—æ¯ç¼©å†™
    
    var frequency: Int = 0        // è¯é¢‘
    
    var type: String = ""         // è¯å…¸ç±»å‹
}
```

#### æ•°æ®åº“ç‰¹æ€§
- **ä¸»é”®ç´¢å¼•**ï¼šåŸºäºidçš„å”¯ä¸€æ ‡è¯†
- **æ‹¼éŸ³ç´¢å¼•**ï¼šæ”¯æŒå‰ç¼€åŒ¹é…æŸ¥è¯¢
- **é¦–å­—æ¯ç´¢å¼•**ï¼šæ”¯æŒç¼©å†™æŸ¥è¯¢
- **è¯é¢‘æ’åº**ï¼šæ”¯æŒæŒ‰é¢‘ç‡æ’åº
- **ç±»å‹åˆ†ç±»**ï¼šæ”¯æŒæŒ‰è¯å…¸ç±»å‹ç­›é€‰

#### æŸ¥è¯¢ä¼˜åŒ–
```kotlin
// å‰ç¼€åŒ¹é…æŸ¥è¯¢
realm.query(Entry::class)
    .query("pinyin BEGINSWITH $0 OR initialLetters BEGINSWITH $0", query)
    .limit(limit)
    .find()
```

### ğŸŒ³ Trieæ ‘è®¾è®¡

#### PinyinTrieç»“æ„
```kotlin
class PinyinTrie : Serializable {
    private val root = TrieNode()           // æ ¹èŠ‚ç‚¹
    private val lock = ReentrantReadWriteLock() // è¯»å†™é”
    
    // æ’å…¥è¯è¯­
    fun insert(pinyin: String, word: String, frequency: Int)
    
    // å‰ç¼€æœç´¢
    fun searchByPrefix(prefix: String, limit: Int): List<WordItem>
    
    // å†…å­˜ç»Ÿè®¡
    fun getMemoryStats(): TrieMemoryStats
}
```

#### TrieNodeèŠ‚ç‚¹è®¾è®¡
```kotlin
class TrieNode : Serializable {
    val children: MutableMap<Char, TrieNode> = HashMap()
    val words: MutableList<WordItem> = ArrayList()
    var isEndOfWord: Boolean = false
    
    companion object {
        const val MAX_WORDS_PER_NODE = 50        // æ™®é€šèŠ‚ç‚¹æœ€å¤§è¯æ•°
        const val MAX_WORDS_PER_NODE_CHARS = 1000 // å•å­—èŠ‚ç‚¹æœ€å¤§è¯æ•°
    }
}
```

#### æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§
- **å†…å­˜æ˜ å°„**ï¼šå¤§æ–‡ä»¶(>10MB)ä½¿ç”¨å†…å­˜æ˜ å°„åŠ è½½
- **64KBç¼“å†²åŒº**ï¼šä¼˜åŒ–æ–‡ä»¶è¯»å–æ€§èƒ½
- **å¹¶è¡ŒåŠ è½½**ï¼šå¤šè¯å…¸å¹¶è¡Œåˆå§‹åŒ–
- **çº¿ç¨‹å®‰å…¨**ï¼šReentrantReadWriteLockä¿æŠ¤å¹¶å‘è®¿é—®
- **å®¹é‡é™åˆ¶**ï¼šèŠ‚ç‚¹è¯æ•°é™åˆ¶ï¼Œé¿å…å†…å­˜å ç”¨è¿‡å¤§

#### Trieæ–‡ä»¶æ ¼å¼
```
äºŒè¿›åˆ¶æ ¼å¼ï¼š
[æ‹¼éŸ³é•¿åº¦(4å­—èŠ‚)][æ‹¼éŸ³å†…å®¹][è¯æ•°(4å­—èŠ‚)]
[è¯1é•¿åº¦(4å­—èŠ‚)][è¯1å†…å®¹][è¯1é¢‘ç‡(4å­—èŠ‚)]
[è¯2é•¿åº¦(4å­—èŠ‚)][è¯2å†…å®¹][è¯2é¢‘ç‡(4å­—èŠ‚)]
...
```

### ğŸ”§ TrieManagerç®¡ç†å™¨

#### æ ¸å¿ƒåŠŸèƒ½
- **æŒ‰éœ€åŠ è½½**ï¼šè¯å…¸æŒ‰éœ€åŠ¨æ€åŠ è½½ï¼Œå‡å°‘å¯åŠ¨æ—¶å†…å­˜å‹åŠ›
- **å¹¶è¡Œåˆå§‹åŒ–**ï¼šå¤šè¯å…¸å¹¶è¡ŒåŠ è½½ï¼Œæå‡å¯åŠ¨é€Ÿåº¦
- **çŠ¶æ€ç®¡ç†**ï¼šè·Ÿè¸ªåŠ è½½çŠ¶æ€å’Œå¥åº·çŠ¶æ€
- **å†…å­˜ä¼˜åŒ–**ï¼šæ”¯æŒå†…å­˜æ˜ å°„å’Œå¤§ç¼“å†²åŒº

#### åŠ è½½ç­–ç•¥
```kotlin
// è½»é‡çº§åˆå§‹åŒ–ï¼ˆå¯åŠ¨æ—¶ï¼‰
fun init() {
    // åªæ£€æŸ¥å¯ç”¨æ–‡ä»¶ï¼Œä¸åŠ è½½åˆ°å†…å­˜
    val availableTypes = checkAvailableTrieFiles()
    isInitialized = true
}

// æŒ‰éœ€åŠ è½½ï¼ˆä½¿ç”¨æ—¶ï¼‰
suspend fun ensureTrieLoaded(trieType: TrieType) {
    if (!isTrieLoaded(trieType)) {
        loadTrieFromAssets(trieType)
    }
}
```

## ğŸ¤– AIé›†æˆè¯¦è§£

### ğŸ§  åŒå¼•æ“LLMæ¶æ„è®¾è®¡

#### MediaPipeå¼•æ“ (LlmManager)
```kotlin
class LlmManager {
    // æ¨¡å‹ç®¡ç†
    private var llmInference: LlmInference? = null
    
    // å¼‚æ­¥åˆå§‹åŒ–
    suspend fun initialize(): Boolean
    
    // æ–‡æœ¬ç”Ÿæˆ
    suspend fun generateResponse(prompt: String): String?
    
    // èµ„æºç®¡ç†
    fun release()
}
```

#### MNNæ¨ç†å¼•æ“ (MnnLlmSession)
```kotlin
class LlmSession {
    // NativeæŒ‡é’ˆç®¡ç†
    private var nativePtr: Long = 0
    
    // æ¨¡å‹åŠ è½½
    fun load()
    
    // æ–‡æœ¬ç”Ÿæˆ
    fun generate(prompt: String, params: Map<String, Any>): HashMap<String, Any>
    
    // ä¼šè¯é‡ç½®
    fun reset(): String
    
    // èµ„æºé‡Šæ”¾
    fun release()
}
```

#### C++åŸç”Ÿå®ç°
```cpp
// JNIæ¥å£å®ç°
extern "C" {
    JNIEXPORT jlong JNICALL Java_com_shenji_aikeyboard_mnn_llm_LlmSession_initNative(
        JNIEnv *env, jobject thiz, jstring modelDir, jobject chat_history, 
        jstring mergeConfigStr, jstring configJsonStr);
    
    JNIEXPORT jobject JNICALL Java_com_shenji_aikeyboard_mnn_llm_LlmSession_submitNative(
        JNIEnv *env, jobject thiz, jlong llmPtr, jstring inputStr, 
        jboolean keepHistory, jobject progressListener);
}
```

#### æ¨¡å‹é…ç½®
```kotlin
// MediaPipeé…ç½®
val options = LlmInference.LlmInferenceOptions.builder()
    .setModelPath(modelFile.absolutePath)
    .setMaxTokens(1024)
    .setMaxTopK(40)
    .build()

// MNNé…ç½®
val config = ModelConfig.loadMergedConfig(configPath, extraConfigFile)
val configMap = HashMap<String, Any>().apply {
    put("is_r1", ModelUtils.isR1Model(modelId))
    put("mmap_dir", rootCacheDir ?: "")
    put("keep_history", keepHistory)
}
```

### ğŸš€ AIåŠŸèƒ½å®ç°

#### æ‹¼éŸ³çº é”™
```kotlin
suspend fun correctPinyin(
    input: String, 
    context: InputContext
): List<CorrectionSuggestion> {
    val prompt = buildCorrectionPrompt(input, context)
    val response = llmManager?.generateResponse(prompt)
    return parseCorrectionResponse(response, input)
}
```

#### æ–‡æœ¬ç»­å†™
```kotlin
suspend fun generateContinuation(
    text: String,
    context: InputContext
): List<ContinuationSuggestion> {
    val prompt = buildContinuationPrompt(text, context)
    val response = llmManager?.generateResponse(prompt)
    return parseContinuationResponse(response)
}
```

#### è¯­ä¹‰åˆ†æ
```kotlin
suspend fun analyzeSemantics(
    input: String,
    context: InputContext
): SemanticAnalysis {
    val prompt = buildSemanticPrompt(input, context)
    val response = llmManager?.generateResponse(prompt)
    return parseSemanticResponse(response)
}
```

### ğŸš€ åŒå¼•æ“æ€§èƒ½ä¼˜åŒ–

#### MediaPipeå¼•æ“ä¼˜åŒ–
- **å¼‚æ­¥åŠ è½½**ï¼šåå°çº¿ç¨‹åŠ è½½æ¨¡å‹ï¼Œä¸é˜»å¡UI
- **æ–‡ä»¶éªŒè¯**ï¼šåŠ è½½å‰éªŒè¯æ¨¡å‹æ–‡ä»¶å®Œæ•´æ€§
- **å†…å­˜ç®¡ç†**ï¼šæ™ºèƒ½å†…å­˜åˆ†é…å’Œé‡Šæ”¾
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

#### MNNå¼•æ“ä¼˜åŒ–
- **C++åŸç”Ÿæ€§èƒ½**ï¼šç›´æ¥è°ƒç”¨MNN C++åº“ï¼Œæ€§èƒ½æ›´ä¼˜
- **å†…å­˜æ˜ å°„**ï¼šæ”¯æŒmmapåŠ è½½å¤§æ¨¡å‹ï¼Œå‡å°‘å†…å­˜å ç”¨
- **å¤šæ¨¡æ€æ”¯æŒ**ï¼šæ”¯æŒæ–‡æœ¬ã€éŸ³é¢‘ç­‰å¤šç§æ¨¡æ€å¤„ç†
- **JNIä¼˜åŒ–**ï¼šé«˜æ•ˆçš„Java-Nativeäº¤äº’
- **ä¼šè¯ç®¡ç†**ï¼šæ”¯æŒå†å²å¯¹è¯ä¿æŒå’Œé‡ç½®

#### é€šç”¨æ¨ç†ä¼˜åŒ–
- **åŒå¼•æ“è°ƒåº¦**ï¼šæ ¹æ®ä»»åŠ¡ç±»å‹æ™ºèƒ½é€‰æ‹©æœ€ä¼˜å¼•æ“
- **æ‰¹å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡æ–‡æœ¬å¤„ç†
- **ç¼“å­˜æœºåˆ¶**ï¼šå¸¸ç”¨æ¨ç†ç»“æœç¼“å­˜
- **èµ„æºç›‘æ§**ï¼šå®æ—¶ç›‘æ§å†…å­˜å’ŒCPUä½¿ç”¨
- **æ€§èƒ½ç»Ÿè®¡**ï¼šæ¨ç†æ—¶é—´å’Œååé‡ç»Ÿè®¡

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ğŸš€ å¯åŠ¨æ€§èƒ½
- **å†·å¯åŠ¨æ—¶é—´**ï¼š< 500ms
- **çƒ­å¯åŠ¨æ—¶é—´**ï¼š< 200ms
- **å†…å­˜å ç”¨**ï¼š< 100MB (åŸºç¡€åŠŸèƒ½)
- **è½»é‡çº§åˆå§‹åŒ–**ï¼šä¸åœ¨å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰è¯å…¸
- **AIæ¨¡å‹åŠ è½½**ï¼š< 15ç§’ (åå°å¼‚æ­¥)

### âš¡ æŸ¥è¯¢æ€§èƒ½
- **å•æ¬¡æŸ¥è¯¢**ï¼š1-3ms
- **å¹¶å‘æŸ¥è¯¢**ï¼šæ”¯æŒå¤šçº¿ç¨‹
- **ç¼“å­˜å‘½ä¸­ç‡**ï¼š> 90%
- **åˆ†å±‚æŸ¥è¯¢**ï¼šæ™ºèƒ½åˆ†å±‚æ˜¾ç¤ºï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- **æ¸è¿›å¼åŠ è½½**ï¼šæ”¯æŒåˆ†é¡µåŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šå€™é€‰è¯
- **å¤šç­–ç•¥è·¯ç”±**ï¼šæ ¹æ®è¾“å…¥ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æŸ¥è¯¢ç­–ç•¥

### ğŸ¤– AIæ€§èƒ½
- **æ¨ç†å“åº”æ—¶é—´**ï¼š< 5ç§’
- **æ¨¡å‹å†…å­˜å ç”¨**ï¼š< 3GB
- **æ¨ç†ååé‡**ï¼š47 tokens/sec (Samsung S24 Ultra)
- **é¦–æ¬¡å“åº”æ—¶é—´**ï¼š< 3ç§’
- **æ¨¡å‹å¤§å°**ï¼š529MB (INT4é‡åŒ–)

### ğŸ’¾ å­˜å‚¨æ•ˆç‡
- **è¯å…¸å‹ç¼©ç‡**ï¼š60%+
- **ç´¢å¼•å¤§å°**ï¼š< 50MB
- **æ€»å®‰è£…åŒ…**ï¼š< 250MB
- **Trieæ–‡ä»¶å¤§å°**ï¼š29.4MBï¼ˆæ‰€æœ‰è¯å…¸ï¼‰
- **Realmæ•°æ®åº“**ï¼š229MB
- **AIæ¨¡å‹æ–‡ä»¶**ï¼š529MB

### ğŸ§  å†…å­˜ç®¡ç†
- **åˆ†å±‚åŠ è½½**ï¼šå¯åŠ¨æ—¶åªåŠ è½½æ ¸å¿ƒè¯å…¸
- **æŒ‰éœ€åˆå§‹åŒ–**ï¼šåå°å¼‚æ­¥åŠ è½½æ‰©å±•è¯å…¸
- **å†…å­˜ç›‘æ§**ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- **LRUç¼“å­˜**ï¼šæŸ¥è¯¢ç¼“å­˜(100æ¡)
- **èŠ‚ç‚¹å®¹é‡é™åˆ¶**ï¼šé¿å…å•èŠ‚ç‚¹å†…å­˜å ç”¨è¿‡å¤§
- **AIå†…å­˜ä¼˜åŒ–**ï¼šæ™ºèƒ½æ¨¡å‹å†…å­˜ç®¡ç†

### ğŸš« é˜²é—ªçƒä¼˜åŒ–
- **æ™ºèƒ½é˜²æŠ–æœºåˆ¶**ï¼š50-150msåŠ¨æ€é˜²æŠ–
- **åŒç¼“å†²æŠ€æœ¯**ï¼šå†…å®¹æ¯”è¾ƒ + æ›´æ–°é”å®š
- **é¢„æµ‹æ˜¾ç¤ºç³»ç»Ÿ**ï¼šLRUç¼“å­˜ + å³æ—¶é¢„è§ˆ
- **è§†å›¾å¤ç”¨ä¼˜åŒ–**ï¼šTextViewå¤ç”¨ + å¢é‡æ›´æ–°
- **é—ªçƒæ¶ˆé™¤ç‡**ï¼š95%+

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç¯å¢ƒè¦æ±‚
- **JDK**: 21+
- **Android Studio**: Arctic Fox+
- **Gradle**: 8.7+
- **Android SDK**: 35+
- **è®¾å¤‡å†…å­˜**: 4GB+ (æ¨è8GB+ç”¨äºAIåŠŸèƒ½)
- **å­˜å‚¨ç©ºé—´**: 2GB+ å¯ç”¨ç©ºé—´

### ğŸ”§ å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-username/shenji-input-method.git
cd shenji-input-method
```

2. **é…ç½®ç¯å¢ƒ**
```bash
# è®¾ç½®Javaç¯å¢ƒ
export JAVA_HOME=/path/to/jdk21

# é…ç½®Gradle
./gradlew --version
```

3. **æ„å»ºé¡¹ç›®**
```bash
# æ„å»ºDebugç‰ˆæœ¬
./gradlew assembleDebug

# å®‰è£…åˆ°è®¾å¤‡
./gradlew installDebug
```

4. **å¯ç”¨è¾“å…¥æ³•**
   - è¿›å…¥ è®¾ç½® â†’ è¯­è¨€å’Œè¾“å…¥æ³• â†’ ç®¡ç†é”®ç›˜
   - å¯ç”¨"ç¥è¿¹è¾“å…¥æ³•"
   - è®¾ç½®ä¸ºé»˜è®¤è¾“å…¥æ³•

### ğŸ“± ä½¿ç”¨æŒ‡å—

1. **åŸºç¡€è¾“å…¥**ï¼šç›´æ¥è¾“å…¥æ‹¼éŸ³ï¼Œé€‰æ‹©å€™é€‰è¯
2. **å¿«é€Ÿè¾“å…¥**ï¼šä½¿ç”¨é¦–å­—æ¯ç¼©å†™ï¼ˆå¦‚ï¼šbj â†’ åŒ—äº¬ï¼‰
3. **AIåŠŸèƒ½**ï¼šé•¿æŒ‰ç©ºæ ¼é”®æˆ–ç‰¹å®šæ‰‹åŠ¿è§¦å‘AIåŠ©æ‰‹
4. **è°ƒè¯•æ¨¡å¼**ï¼šåœ¨è®¾ç½®ä¸­å¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
5. **è¯å…¸ç®¡ç†**ï¼šé€šè¿‡ä¸»ç•Œé¢è¿›å…¥è¯å…¸ç®¡ç†ä¸­å¿ƒ

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ğŸ“ é¡¹ç›®ç»“æ„
```
app/src/main/java/com/shenji/aikeyboard/
â”œâ”€â”€ keyboard/               # å€™é€‰è¯å¼•æ“æ ¸å¿ƒ
â”‚   â”œâ”€â”€ SmartPinyinEngine.kt      # æ™ºèƒ½æ‹¼éŸ³å¼•æ“
â”‚   â”œâ”€â”€ IntelligentQueryEngine.kt # æ™ºèƒ½æŸ¥è¯¢å¼•æ“
â”‚   â”œâ”€â”€ ContinuousPinyinEngine.kt # è¿ç»­æ‹¼éŸ³å¼•æ“
â”‚   â”œâ”€â”€ InputStrategy.kt          # è¾“å…¥ç­–ç•¥åˆ†æå™¨
â”‚   â””â”€â”€ ShenjiInputMethodService.kt # è¾“å…¥æ³•æœåŠ¡
â”œâ”€â”€ ai/                     # AIæ¨ç†æ¨¡å—
â”‚   â”œâ”€â”€ AIEngine.kt         # AIå¼•æ“æ¥å£
â”‚   â”œâ”€â”€ AIEngineManager.kt  # AIå¼•æ“ç®¡ç†å™¨
â”‚   â”œâ”€â”€ Gemma3Engine.kt     # Gemma3å¼•æ“å®ç°
â”‚   â””â”€â”€ InputMethodAIAdapter.kt # è¾“å…¥æ³•AIé€‚é…å™¨
â”œâ”€â”€ llm/                    # MediaPipe LLMæ¨¡å—
â”‚   â”œâ”€â”€ LlmManager.kt       # MediaPipe LLMç®¡ç†å™¨
â”‚   â””â”€â”€ LlmUtils.kt         # LLMå·¥å…·ç±»
â”œâ”€â”€ mnn/                    # MNNæ¨ç†æ¡†æ¶æ¨¡å—
â”‚   â”œâ”€â”€ llm/               # MNN LLMå®ç°
â”‚   â”‚   â”œâ”€â”€ LlmSession.kt  # MNNä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ChatSession.kt # èŠå¤©ä¼šè¯æ¥å£
â”‚   â”‚   â””â”€â”€ ChatService.kt # èŠå¤©æœåŠ¡
â”‚   â”œâ”€â”€ utils/             # MNNå·¥å…·ç±»
â”‚   â””â”€â”€ MnnLlmApplication.kt # MNNåº”ç”¨ç±»
â”œâ”€â”€ data/                   # æ•°æ®å±‚
â”‚   â”œâ”€â”€ trie/              # Trieæ ‘å®ç°
â”‚   â”‚   â”œâ”€â”€ TrieManager.kt # Trieæ ‘ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ PinyinTrie.kt  # æ‹¼éŸ³Trieæ ‘
â”‚   â”‚   â”œâ”€â”€ TrieNode.kt    # TrieèŠ‚ç‚¹
â”‚   â”‚   â””â”€â”€ TrieType.kt    # Trieç±»å‹æšä¸¾
â”‚   â””â”€â”€ Entry.kt           # æ•°æ®æ¨¡å‹
â”œâ”€â”€ pinyin/                # æ‹¼éŸ³å¤„ç†
â”‚   â”œâ”€â”€ UnifiedPinyinSplitter.kt # ç»Ÿä¸€æ‹¼éŸ³åˆ†å‰²å™¨
â”‚   â”œâ”€â”€ InputType.kt       # è¾“å…¥ç±»å‹æšä¸¾
â”‚   â””â”€â”€ MatchType.kt       # åŒ¹é…ç±»å‹æšä¸¾
â”œâ”€â”€ ui/                    # ç”¨æˆ·ç•Œé¢
â”œâ”€â”€ utils/                 # å·¥å…·ç±»
â””â”€â”€ ShenjiApplication.kt   # åº”ç”¨å…¥å£

app/src/main/cpp/              # ğŸ”§ C++åŸç”Ÿä»£ç 
â”œâ”€â”€ llm_mnn_jni.cpp           # MNN JNIæ¥å£å®ç°
â”œâ”€â”€ llm_session.cpp           # LLMä¼šè¯C++å®ç°
â”œâ”€â”€ CMakeLists.txt            # CMakeæ„å»ºé…ç½®
â””â”€â”€ include/                  # C++å¤´æ–‡ä»¶

app/src/main/jniLibs/         # ğŸ“š Nativeåº“æ–‡ä»¶
â””â”€â”€ arm64-v8a/
    â”œâ”€â”€ libMNN.so             # MNNæ¨ç†å¼•æ“åº“(5.7MB)
    â””â”€â”€ libc++_shared.so      # C++è¿è¡Œæ—¶åº“
```

### ğŸ”§ Trieé¢„ç¼–è¯‘å·¥å…·åŒ…

é¡¹ç›®æä¾›äº†å®Œæ•´çš„Trieé¢„ç¼–è¯‘å·¥å…·åŒ…ï¼Œç”¨äºå°†YAMLæ ¼å¼çš„è¯å…¸æ–‡ä»¶è½¬æ¢ä¸ºé«˜æ€§èƒ½çš„äºŒè¿›åˆ¶Trieæ•°æ®æ–‡ä»¶ã€‚

#### å·¥å…·ç‰¹æ€§
- **å£°è°ƒå¤„ç†**ï¼šè‡ªåŠ¨å»é™¤æ‹¼éŸ³ä¸­çš„å£°è°ƒç¬¦å·
- **è¯é¢‘ç­›é€‰**ï¼šæ”¯æŒæŒ‰ç™¾åˆ†æ¯”ç­›é€‰é«˜é¢‘è¯æ±‡
- **æ ¼å¼å…¼å®¹**ï¼šç”ŸæˆJava ObjectInputStreamå…¼å®¹çš„äºŒè¿›åˆ¶æ ¼å¼
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæŸ¥è¯¢å“åº”æ—¶é—´1-3ms

#### ä½¿ç”¨æ–¹æ³•

```bash
# æ„å»ºåŸºç¡€è¯å…¸Trieï¼ˆä¿ç•™60%é«˜é¢‘è¯ï¼‰
python build_universal_trie.py --type base --percentage 0.6 --verify

# æ„å»ºå…³è”è¯å…¸ï¼ˆ30%é«˜é¢‘è¯ï¼‰
python build_universal_trie.py --type correlation --percentage 0.3 --verify

# æ‰¹é‡æ„å»ºæ‰€æœ‰è¯å…¸
for dict_type in base correlation associational poetry; do
    python build_universal_trie.py --type $dict_type --percentage 0.6 --verify
done
```

### ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

#### å•å…ƒæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./gradlew test

# è¿è¡Œç‰¹å®šæµ‹è¯•
./gradlew testDebugUnitTest
```

#### è°ƒè¯•å·¥å…·
- **è¾“å…¥è°ƒè¯•å™¨**ï¼šå®æ—¶æŸ¥çœ‹å€™é€‰è¯ç”Ÿæˆè¿‡ç¨‹
- **Trieæ„å»ºå™¨**ï¼šå¯è§†åŒ–è¯å…¸æ„å»ºå’Œæµ‹è¯•
- **æ€§èƒ½ç›‘æ§**ï¼šå†…å­˜ä½¿ç”¨å’ŒæŸ¥è¯¢æ€§èƒ½åˆ†æ
- **AIè°ƒè¯•å™¨**ï¼šLLMæ¨ç†æ€§èƒ½ç›‘æ§

#### AIåŠŸèƒ½æµ‹è¯•
- **ç‹¬ç«‹æµ‹è¯•Activity**ï¼šä¸“é—¨çš„AIåŠŸèƒ½æµ‹è¯•ç•Œé¢
- **æ‹¼éŸ³çº é”™æµ‹è¯•**ï¼šé”™è¯¯æ‹¼éŸ³æ£€æµ‹å’Œçº æ­£
- **æ–‡æœ¬ç»­å†™æµ‹è¯•**ï¼šæ™ºèƒ½æ–‡æœ¬è¡¥å…¨
- **è¯­ä¹‰åˆ†ææµ‹è¯•**ï¼šæ„å›¾è¯†åˆ«å’Œæƒ…æ„Ÿåˆ†æ

## ğŸ¤ è´¡çŒ®æŒ‡å—

### ğŸ”€ æäº¤æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

### ğŸ“ ä»£ç è§„èŒƒ
- éµå¾ª Kotlin å®˜æ–¹ç¼–ç è§„èŒƒ
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å’Œå‡½æ•°å
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- AIç›¸å…³ä»£ç éœ€è¦æ·»åŠ æ€§èƒ½æµ‹è¯•

### ğŸ› é—®é¢˜æŠ¥å‘Š
è¯·ä½¿ç”¨ [GitHub Issues](https://github.com/your-username/shenji-input-method/issues) æŠ¥å‘Šé—®é¢˜ï¼ŒåŒ…å«ï¼š
- è®¾å¤‡ä¿¡æ¯å’ŒAndroidç‰ˆæœ¬
- è¯¦ç»†çš„é‡ç°æ­¥éª¤
- ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯
- é¢„æœŸè¡Œä¸ºå’Œå®é™…è¡Œä¸º
- AIåŠŸèƒ½ç›¸å…³é—®é¢˜è¯·åŒ…å«æ¨¡å‹åŠ è½½çŠ¶æ€

## ğŸ”® æœªæ¥è§„åˆ’

### ğŸš€ çŸ­æœŸç›®æ ‡ (v1.1)
- [ ] ä¼˜åŒ–AIæ¨ç†æ€§èƒ½ï¼Œå‡å°‘å“åº”æ—¶é—´
- [ ] å¢åŠ æ›´å¤šAIåŠŸèƒ½åœºæ™¯ï¼ˆè¯­éŸ³è¾“å…¥ã€å›¾ç‰‡è¯†åˆ«ï¼‰
- [ ] å®Œå–„é˜²é—ªçƒä¼˜åŒ–ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- [ ] å¢å¼ºè¯å…¸ç®¡ç†åŠŸèƒ½

### ğŸŒŸ ä¸­æœŸç›®æ ‡ (v2.0)
- [ ] æ”¯æŒå¤šæ¨¡æ€AIæ¨¡å‹é›†æˆ
- [ ] ä¸ªæ€§åŒ–AIå­¦ä¹ å’Œé€‚é…
- [ ] äº‘ç«¯æ¨¡å‹åŒæ­¥ï¼ˆå¯é€‰ï¼‰
- [ ] å¤šè¯­è¨€æ”¯æŒæ‰©å±•

### ğŸ¯ é•¿æœŸç›®æ ‡ (v3.0)
- [ ] å®Œæ•´çš„AIåŠ©æ‰‹åŠŸèƒ½ç”Ÿæ€
- [ ] è·¨å¹³å°æ”¯æŒï¼ˆiOSã€Webï¼‰
- [ ] å¼€æ”¾APIæ¥å£å’ŒSDK
- [ ] ä¼ä¸šçº§éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Realm-Kotlin](https://github.com/realm/realm-kotlin) - é«˜æ€§èƒ½ç§»åŠ¨æ•°æ®åº“
- [Timber](https://github.com/JakeWharton/timber) - Androidæ—¥å¿—æ¡†æ¶
- [Material Components](https://github.com/material-components/material-components-android) - UIç»„ä»¶åº“
- [SnakeYAML](https://bitbucket.org/snakeyaml/snakeyaml) - YAMLè§£æåº“
- [MediaPipe](https://github.com/google-ai-edge/mediapipe) - AIæ¨ç†æ¡†æ¶
- [Google Gemma](https://ai.google.dev/gemma) - å¼€æºè¯­è¨€æ¨¡å‹
- [é˜¿é‡Œå·´å·´MNN](https://github.com/alibaba/MNN) - é«˜æ€§èƒ½ç§»åŠ¨ç«¯æ¨ç†æ¡†æ¶

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**ï¼š[GitHub Repository](https://github.com/your-username/shenji-input-method)
- **é—®é¢˜åé¦ˆ**ï¼š[GitHub Issues](https://github.com/your-username/shenji-input-method/issues)
- **é‚®ç®±**ï¼šyour-email@example.com

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ª â­ï¸**

Made with â¤ï¸ and ğŸ¤– by [Your Name](https://github.com/your-username)

</div> 