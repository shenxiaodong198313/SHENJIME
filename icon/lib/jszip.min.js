// 简化的JSZip实现
class SimpleZip {
    constructor() {
        this.files = {};
    }
    
    file(name, data, options = {}) {
        this.files[name] = {
            data: data,
            options: options
        };
        return this;
    }
    
    folder(name) {
        return {
            file: (fileName, data, options = {}) => {
                this.files[name + '/' + fileName] = {
                    data: data,
                    options: options
                };
                return this;
            }
        };
    }
    
    generateAsync(options = {}) {
        return new Promise((resolve) => {
            // 简化实现：创建一个包含所有文件信息的对象
            const result = {
                files: this.files,
                download: (filename) => {
                    // 为每个文件创建下载链接
                    Object.keys(this.files).forEach(fileName => {
                        const file = this.files[fileName];
                        let blob;
                        
                        if (file.options.base64) {
                            // 处理base64数据
                            const byteCharacters = atob(file.data);
                            const byteNumbers = new Array(byteCharacters.length);
                            for (let i = 0; i < byteCharacters.length; i++) {
                                byteNumbers[i] = byteCharacters.charCodeAt(i);
                            }
                            const byteArray = new Uint8Array(byteNumbers);
                            blob = new Blob([byteArray], {type: 'image/png'});
                        } else {
                            blob = new Blob([file.data], {type: 'text/plain'});
                        }
                        
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = fileName;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    });
                }
            };
            resolve(result);
        });
    }
}

// 全局JSZip构造函数
window.JSZip = SimpleZip; 